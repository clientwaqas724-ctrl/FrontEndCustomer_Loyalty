{% extends 'My_Home/base.html' %}
{% load static %}

{% block title %}Reset Password{% endblock %}

{% block content %}
<main class="main-content py-5">
  <div class="container col-md-6">
    <h3 class="text-center mb-4">Reset Password</h3>

    {% for message in messages %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endfor %}

    {% if email %}
      <div class="alert alert-info">
        Reset password for: <strong>{{ email }}</strong>
      </div>
    {% endif %}

    <form method="POST">
      {% csrf_token %}
      <input type="hidden" name="uid" value="{{ uid }}">
      <input type="hidden" name="token" value="{{ token }}">

      <div class="form-group mb-3">
        <label for="new_password" class="form-label">New Password</label>
        <input type="password" name="new_password" id="new_password" class="form-control" 
               placeholder="Enter new password" required minlength="6">
        <div class="form-text">Password must be at least 6 characters long.</div>
      </div>

      <div class="form-group mb-3">
        <label for="confirm_password" class="form-label">Confirm Password</label>
        <input type="password" name="confirm_password" id="confirm_password" class="form-control" 
               placeholder="Confirm new password" required>
      </div>

      <button type="submit" class="btn btn-success w-100">Update Password</button>
    </form>

    <div class="text-center mt-3">
      <a href="{% url 'forget_password' %}" class="text-decoration-none">Request new reset link</a>
    </div>

    <!-- {% if reset_link %}
      <div class="mt-3 p-3 bg-light rounded">
        <p class="text-muted small mb-1">Debug Reset Link:</p>
        <code class="small">{{ reset_link }}</code>
      </div>
    {% endif %} -->
  </div>
</main>

<script>
// Simple password confirmation check
document.querySelector('form').addEventListener('submit', function(e) {
    const password = document.getElementById('new_password').value;
    const confirmPassword = document.getElementById('confirm_password').value;
    
    if (password !== confirmPassword) {
        e.preventDefault();
        alert('Passwords do not match!');
        return false;
    }
    
    if (password.length < 6) {
        e.preventDefault();
        alert('Password must be at least 6 characters long!');
        return false;
    }
});
</script>
{% endblock %}