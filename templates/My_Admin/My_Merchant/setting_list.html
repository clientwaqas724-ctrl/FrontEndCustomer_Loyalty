{% extends 'My_Admin/base.html' %}
{% load static %}
{% block title %}Admin Management - Admin Portal{% endblock %}
{% block content %}

<!-- Top Bar -->
<div class="top-bar">
    <div class="page-title">
        <button type="button" id="sidebarCollapse" class="toggle-btn me-3">
            <i class="fas fa-bars"></i>
        </button>
        <h1>Admin Management</h1>
    </div>
    
    <div class="user-info">
        <div class="user-details">
            <div class="user-role">{{ user_profile.email }}</div>
            {% if user_profile.role %}
                <div class="user-role">{{ user_profile.role|title }}</div>
            {% endif %}
        </div>
        <div class="user-avatar">
            {{ user_profile.name|first|upper }}
        </div>
        <div class="dropdown">
            <a href="#" class="d-flex align-items-center text-dark text-decoration-none dropdown-toggle" id="dropdownUser" data-bs-toggle="dropdown" aria-expanded="false">
                <i class="fas fa-ellipsis-v"></i>
            </a>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownUser">
                <li><a class="dropdown-item" href="#"><i class="fas fa-user me-2"></i> Profile</a></li>
                <li><a class="dropdown-item" href="#"><i class="fas fa-cog me-2"></i> Settings</a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="{% url 'logout' %}"><i class="fas fa-sign-out-alt me-2"></i> Logout</a></li>
            </ul>
        </div>
        <div class="user-name">{{ user_profile.name|default:"Admin" }}</div>
    </div>
</div>

<br>
<div class="container-fluid">
    <!-- Messages -->
    {% if messages %}
    <div class="mb-4">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Search and View Toggle -->
    <div class="row mb-4">
        <div class="col-md-6">
            <form method="GET" class="d-flex">
                <input type="text" name="search" class="form-control me-2" placeholder="Search admins..." value="{{ search_query }}">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-search"></i> Search
                </button>
            </form>
        </div>
        <div class="col-md-6 text-end">
            <div class="btn-group" role="group">
                <button type="button" class="btn btn-outline-primary active" id="cardViewBtn">
                    <i class="fas fa-th-large"></i> Card View
                </button>
                <button type="button" class="btn btn-outline-primary" id="tableViewBtn">
                    <i class="fas fa-table"></i> Table View
                </button>
            </div>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="row mb-4">
        <div class="col-xl-3 col-md-6">
            <div class="card bg-primary text-white mb-4">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <div class="fs-4 fw-bold">{{ customers.paginator.count }}</div>
                            <div>Total Admins</div>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-users fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="card bg-success text-white mb-4">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <div class="fs-4 fw-bold">{{ customers.paginator.count }}</div>
                            <div>Active Admins</div>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-user-check fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="card bg-warning text-white mb-4">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <div class="fs-4 fw-bold">{{ customers.paginator.count }}</div>
                            <div>Total Roles</div>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-user-tag fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="card bg-info text-white mb-4">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <div class="fs-4 fw-bold">{{ customers.paginator.count }}</div>
                            <div>This Month</div>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-chart-line fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Card View -->
    <div id="cardView" class="view-section">
        <div class="row">
            {% for customer in customers %}
            <div class="col-xl-4 col-md-6 mb-4">
                <div class="card admin-card h-100">
                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                        <h6 class="m-0 fw-bold">{{ customer.name|default:"N/A" }}</h6>
                        <span class="badge bg-light text-dark">{{ customer.role|default:"admin"|title }}</span>
                    </div>
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-12 text-center mb-3">
                                {% if customer.profile_image %}
                                    <img src="{{ customer.profile_image }}" alt="{{ customer.name }}" class="rounded-circle" width="80" height="80">
                                {% else %}
                                    <div class="bg-secondary rounded-circle d-inline-flex align-items-center justify-content-center" style="width: 80px; height: 80px;">
                                        <span class="text-white fw-bold fs-4">{{ customer.name|first|upper }}</span>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="admin-info">
                            <div class="info-item mb-2">
                                <i class="fas fa-envelope me-2 text-primary"></i>
                                <span>{{ customer.email|default:"N/A" }}</span>
                            </div>
                            <div class="info-item mb-2">
                                <i class="fas fa-phone me-2 text-success"></i>
                                <span>{{ customer.phone|default:"N/A" }}</span>
                            </div>
                            <div class="info-item mb-2">
                                <i class="fas fa-map-marker-alt me-2 text-warning"></i>
                                <span>{{ customer.address|default:"N/A" }}</span>
                            </div>
                            <div class="info-item mb-2">
                                <i class="fas fa-map me-2 text-info"></i>
                                <span>{{ customer.region|default:"N/A" }}, {{ customer.state|default:"N/A" }}</span>
                            </div>
                            <div class="info-item mb-2">
                                <i class="fas fa-mail-bulk me-2 text-secondary"></i>
                                <span>{{ customer.postalcode|default:"N/A" }}</span>
                            </div>
                            <div class="info-item">
                                <i class="fas fa-file-signature me-2 text-danger"></i>
                                <span>Terms: 
                                    {% if customer.tc %}
                                        <span class="badge bg-success">Accepted</span>
                                    {% else %}
                                        <span class="badge bg-danger">Not Accepted</span>
                                    {% endif %}
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer bg-light">
                        <div class="row">
                            <div class="col-6">
                                <small class="text-muted">ID: {{ customer.id|default:"N/A" }}</small>
                            </div>
                            <div class="col-6 text-end">
                                <div class="btn-group">
                                    <button class="btn btn-sm btn-outline-primary">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="col-12">
                <div class="card text-center py-5">
                    <div class="card-body">
                        <i class="fas fa-users fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">No Admin Users Found</h5>
                        <p class="text-muted">There are no admin users matching your criteria.</p>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Table View -->
    <div id="tableView" class="view-section d-none">
        <div class="card shadow">
            <div class="card-header bg-primary text-white py-3">
                <h6 class="m-0 font-weight-bold">All Admin Users</h6>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover table-bordered" id="dataTable" width="100%" cellspacing="0">
                        <thead class="table-dark">
                            <tr>
                                <th>ID</th>
                                <th>Profile</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Address</th>
                                <th>Region/State</th>
                                <th>Postal Code</th>
                                <th>Terms</th>
                                <th>Role</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for customer in customers %}
                            <tr>
                                <td class="fw-bold">#{{ customer.id|default:"N/A" }}</td>
                                <td>
                                    {% if customer.profile_image %}
                                        <img src="{{ customer.profile_image }}" alt="{{ customer.name }}" class="rounded-circle" width="40" height="40">
                                    {% else %}
                                        <div class="bg-secondary rounded-circle d-inline-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                            <span class="text-white fw-bold">{{ customer.name|first|upper }}</span>
                                        </div>
                                    {% endif %}
                                </td>
                                <td>{{ customer.name|default:"N/A" }}</td>
                                <td>{{ customer.email|default:"N/A" }}</td>
                                <td>{{ customer.phone|default:"N/A" }}</td>
                                <td>{{ customer.address|default:"N/A" }}</td>
                                <td>
                                    <small>{{ customer.region|default:"N/A" }}</small><br>
                                    <small class="text-muted">{{ customer.state|default:"N/A" }}</small>
                                </td>
                                <td>{{ customer.postalcode|default:"N/A" }}</td>
                                <td>
                                    {% if customer.tc %}
                                        <span class="badge bg-success">Yes</span>
                                    {% else %}
                                        <span class="badge bg-danger">No</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <span class="badge bg-primary">{{ customer.role|default:"admin"|title }}</span>
                                </td>
                                <td>
                                    <div class="btn-group btn-group-sm">
                                        <button class="btn btn-outline-primary" title="Edit">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-outline-danger" title="Delete">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                        <button class="btn btn-outline-info" title="View">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="11" class="text-center py-4">
                                    <i class="fas fa-users fa-2x text-muted mb-2"></i>
                                    <h6 class="text-muted">No Admin Users Found</h6>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Pagination -->
    {% if customers.has_other_pages %}
    <div class="row mt-4">
        <div class="col-12">
            <nav aria-label="Page navigation">
                <ul class="pagination justify-content-center">
                    {% if customers.has_previous %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ customers.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}" aria-label="Previous">
                            <span aria-hidden="true">&laquo;</span>
                        </a>
                    </li>
                    {% endif %}

                    {% for i in customers.paginator.page_range %}
                        {% if customers.number == i %}
                        <li class="page-item active"><span class="page-link">{{ i }}</span></li>
                        {% else %}
                        <li class="page-item"><a class="page-link" href="?page={{ i }}{% if search_query %}&search={{ search_query }}{% endif %}">{{ i }}</a></li>
                        {% endif %}
                    {% endfor %}

                    {% if customers.has_next %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ customers.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}" aria-label="Next">
                            <span aria-hidden="true">&raquo;</span>
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </nav>
        </div>
    </div>
    {% endif %}
</div>

<style>
.admin-card {
    transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
    border: 1px solid #e3e6f0;
}

.admin-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.admin-info .info-item {
    display: flex;
    align-items: center;
    font-size: 0.9rem;
}

.view-section {
    transition: opacity 0.3s ease-in-out;
}

.card-header {
    border-bottom: 1px solid rgba(0,0,0,0.125);
}

.table-hover tbody tr:hover {
    background-color: rgba(0,0,0,0.075);
}

.badge {
    font-size: 0.75em;
}

.btn-group .btn {
    border-radius: 0.375rem;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .admin-info .info-item {
        font-size: 0.8rem;
    }
    
    .card-header h6 {
        font-size: 0.9rem;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const cardViewBtn = document.getElementById('cardViewBtn');
    const tableViewBtn = document.getElementById('tableViewBtn');
    const cardView = document.getElementById('cardView');
    const tableView = document.getElementById('tableView');

    cardViewBtn.addEventListener('click', function() {
        cardView.classList.remove('d-none');
        tableView.classList.add('d-none');
        cardViewBtn.classList.add('active');
        tableViewBtn.classList.remove('active');
    });

    tableViewBtn.addEventListener('click', function() {
        tableView.classList.remove('d-none');
        cardView.classList.add('d-none');
        tableViewBtn.classList.add('active');
        cardViewBtn.classList.remove('active');
    });

    // Initialize with card view
    cardViewBtn.classList.add('active');
    tableView.classList.add('d-none');
});
</script>
{% endblock %}